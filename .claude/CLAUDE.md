# Makebeliv - プロジェクト管理ドキュメント

## 📋 プロジェクト概要

**Makebeliv** は、コナンの変声リボンのような自然で低遅延なボイスチェンジャーを実現するプロジェクトです。

### コンセプト

「チェンジャーとバレない自然さ」と「リアルタイム実況に耐える低遅延」を両立する、完全ローカル動作のボイスチェンジャー。

### プロジェクト名の由来

**Make Believe** (信じ込ませる、ふりをする) から。
声を変えていることを気づかせない、自然な変換を目指す意図を込めています。

---

## 🎯 プロジェクトゴール

### 最重要要件

1. **自然さ** - VTuberレベルの人間らしい声。チェンジャーとバレないこと
2. **低遅延** - 200-300ms以内。実況・会話で違和感がないレベル
3. **原音漏洩ゼロ** - 元の声が一切聞こえないこと（セキュリティ要件）

### 副次的要件

4. **完全ローカル** - 従量課金なし、プライバシー保護
5. **クロスプラットフォーム** - Windows/macOS/Linux対応
6. **高品質でなくてよい** - 電話レベルの音質でも自然ならOK

---

## 💡 オリジナリティ

### 1. 揺らぎエンジン

既存のVCツールにはない、人間らしい自然な変化を実現：

- **時間的連続性**: 急激な変化を避け、前回の値から滑らかに遷移
- **ピッチの微細な揺らぎ**: ±5%の範囲でランダムに変動
- **音量の自然な変化**: 発話ごとに微妙に変化
- **EQの揺らぎ**: 周波数特性に変化を加える

#### なぜ必要か？

RVCなどの既存VCツールは、声自体は高品質でも「機械的」に聞こえることがある。
これは発話ごとの微妙な変化が失われるため。
人間の声は常に揺らいでおり、この揺らぎを再現することで自然さが増す。

### 2. 遅延最小化アーキテクチャ

- **非同期パイプライン**: 録音・変換・再生を並列化
- **先読み処理**: 次のチャンクを事前に変換
- **最適なチャンクサイズ**: 100-200msで品質と遅延のバランス
- **Rust + Python分離**: I/O処理と推論を最適な言語で実装

### 3. ノイズ合成による不自然さの隠蔽

微量の環境音（カフェ、街中、部屋など）を混ぜることで、
VCの不自然さを人間の耳が気づきにくくする。

---

## 🏗️ 技術選定の理由

### なぜRust + Pythonのハイブリッド構成？

| 要素 | 技術 | 理由 |
|------|------|------|
| 音声I/O | Rust (cpal) | GIL/GCの影響なし、低レイテンシ |
| RVC推論 | Python (PyTorch) | 既存エコシステム、GPU対応が成熟 |
| HTTP通信 | Rust (tokio/reqwest) | 非同期処理が得意 |
| UI/CLI | Rust (clap) | クロスプラットフォーム、軽量 |

**結論**: Pythonで完結もRustで完結も不可能。それぞれの強みを活かす。

### なぜuvを採用？

- **高速**: pipより10-100倍速い
- **Rustベース**: makebelivのRust部分と親和性が高い
- **依存関係解決が賢い**: 競合が少ない
- **シンプル**: 学習コストが低い

---

## 🚧 開発フェーズ

### Phase 1: 基盤構築 ✅ (完了)

- [x] プロジェクト構造設計
- [x] uv統合セットアップ
- [x] 基本的なCLI実装
- [x] 揺らぎエンジン基本実装

### Phase 2: コア機能実装 ✅ (完了)

- [x] RVC変換エンジン
- [x] FastAPIサーバー
- [x] Rust HTTPクライアント
- [x] ファイル処理パイプライン完成

### Phase 3: リアルタイム対応 🚧 (進行中)

- [x] 音声I/O実装 (cpal)
- [ ] リアルタイムモード完全実装
- [ ] チャンク処理の最適化
- [ ] 遅延測定・プロファイリング

### Phase 4: 実用化 📅 (計画中)

- [ ] 実際のRVCモデルでテスト
- [ ] 仮想マイク出力統合
- [ ] 遅延最適化（目標200-300ms）
- [ ] 安定性向上

### Phase 5: 拡張機能 💭 (検討中)

- [ ] WebUI (オプション)
- [ ] モデル切り替え機能
- [ ] プリセット管理
- [ ] 録音機能

---

## 📊 現在のステータス (2025-11-17)

### 実装済み

- ✅ プロジェクト構造完成
- ✅ Python環境自動構築 (uv)
- ✅ 揺らぎエンジン
- ✅ RVC変換エンジン (デモモード含む)
- ✅ FastAPIサーバー (非同期、セッション管理)
- ✅ Rust CLI (setup, server, process, monitor, list-devices)
- ✅ Rust音声I/O (cpal)
- ✅ HTTPクライアント
- ✅ Docker対応 (GPU/CPU)
- ✅ 充実したドキュメント

### 未実装・改善点

- ⏳ リアルタイムモードの完全実装
- ⏳ 仮想マイクへの直接出力
- ⏳ 実際のRVCモデルとの統合テスト
- ⏳ 遅延の実測と最適化
- ⏳ チャンク境界のクロスフェード処理
- ⏳ エラーハンドリングの強化

---

## 🎯 次のマイルストーン

### マイルストーン 3.1: リアルタイムモード完成

**目標**: マイク入力→変換→スピーカー出力の完全動作

**タスク**:
1. マイク入力ストリームの実装
2. チャンク単位での変換呼び出し
3. スピーカー出力の実装
4. バッファ管理とオーバーフロー対策

**完了条件**:
- マイクで喋った声が変換されてスピーカーから聞こえる
- 遅延が500ms以内
- 音飛びやノイズがない

### マイルストーン 3.2: 遅延最適化

**目標**: 200-300ms以内の遅延を実現

**タスク**:
1. 各段階の遅延を測定
2. ボトルネックの特定
3. チャンクサイズの最適化
4. 先読み処理の実装

**完了条件**:
- 録音→再生の総遅延が300ms以内
- 遅延が安定している（揺らぎが小さい）

### マイルストーン 4.1: 仮想マイク統合

**目標**: Discord等で使用可能にする

**タスク**:
1. 仮想マイクデバイスへの出力実装
2. OS別の対応 (VB-Cable, BlackHole, snd-aloop)
3. モニタリング機能（自分の声を聞く）

**完了条件**:
- Discordで仮想マイクが選択できる
- 変換後の音声が相手に届く
- 原音が漏れない

---

## 🤔 設計上の課題と議論

詳細は [DECISIONS.md](./DECISIONS.md) を参照。

### 主な論点

1. **Rust vs Python単体 vs ハイブリッド**
   - 結論: ハイブリッド（理由: それぞれの強みを活かす）

2. **通信方式 (HTTP vs IPC)**
   - 結論: HTTP POST（理由: クロスプラットフォーム、実装容易、遅延も許容範囲）

3. **再生はどちらで行うか？**
   - 結論: Python側（理由: 通信オーバーヘッド削減）

4. **チャンク区切りの不自然さ対策**
   - 解決策: クロスフェード、揺らぎの連続性、音声認識による意味単位区切り

---

## 📚 関連ドキュメント

- [ARCHITECTURE.md](./ARCHITECTURE.md) - アーキテクチャ詳細
- [DESIGN.md](./DESIGN.md) - 設計詳細
- [DECISIONS.md](./DECISIONS.md) - 設計決定の記録
- [TODO.md](./TODO.md) - タスク管理

---

## 🙏 謝辞・参考資料

### 技術参考

- [RVC Project](https://github.com/RVC-Project/Retrieval-based-Voice-Conversion-WebUI) - 声変換技術
- [uv](https://github.com/astral-sh/uv) - Python環境管理
- [FastAPI](https://fastapi.tiangolo.com/) - APIフレームワーク
- [cpal](https://github.com/RustAudio/cpal) - Rust音声I/O

### インスピレーション

- Qiita記事: [Soxコマンドでボイスチェンジャー](https://qiita.com/Nabeshin/items/5a904fe0baf76a9bf651)
- Qiita記事: [Soxでリアルタイムボイスチェンジャー](https://qiita.com/teteyateiya/items/e4dc27e384d947b9946d)

---

## 📝 プロジェクト履歴

### 2025-11-17

- プロジェクト開始
- 基盤構築完了 (Phase 1)
- コア機能実装完了 (Phase 2)
- リアルタイム対応開始 (Phase 3)
- ドキュメント整備

---

**最終更新**: 2025-11-17
**ステータス**: Phase 3 進行中
**次のアクション**: リアルタイムモード完全実装
