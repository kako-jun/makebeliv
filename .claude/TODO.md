# Makebeliv TODO管理

現在のタスクと今後の予定を管理します。

---

## 🚀 現在進行中 (Phase 3)

### リアルタイムモード完全実装

- [x] cpal音声I/O実装
- [x] HTTPクライアント実装
- [x] FastAPIチャンク変換エンドポイント
- [ ] **マイク入力→変換→スピーカー出力の統合**
  - [ ] マイク入力ストリームの開始
  - [ ] バッファリング処理
  - [ ] チャンク単位でのAPI呼び出し
  - [ ] スピーカー出力ストリーム
  - [ ] エラーハンドリング（音飛び対策）

---

## 📅 次のフェーズ (Phase 4)

### 実用化に向けた改善

#### 4.1 実際のRVCモデル統合

- [ ] RVCモデルの取得・配置
- [ ] モデルロードのテスト
- [ ] 推論速度の測定
- [ ] メモリ使用量の確認
- [ ] モデル切り替え機能

#### 4.2 遅延測定・最適化

- [ ] 各段階の遅延を測定
  - [ ] マイク入力バッファリング
  - [ ] HTTP通信 (往路)
  - [ ] RVC推論
  - [ ] 揺らぎ適用
  - [ ] HTTP通信 (復路)
  - [ ] スピーカー出力
- [ ] ボトルネックの特定
- [ ] 最適化実施
  - [ ] チャンクサイズ調整
  - [ ] バッファサイズ調整
  - [ ] 並列処理の改善

#### 4.3 仮想マイク統合

- [ ] OS別の仮想マイク調査
  - [ ] Windows: VB-Cable, VoiceMeeter
  - [ ] macOS: BlackHole, Loopback
  - [ ] Linux: snd-aloop (ALSA Loopback)
- [ ] 仮想マイクへの出力実装
- [ ] モニタリング機能（自分の声を聞く）
- [ ] Discord等での動作確認

#### 4.4 安定性向上

- [ ] エラーハンドリング強化
  - [ ] 変換失敗時のフォールバック
  - [ ] ネットワークエラー対策
  - [ ] メモリリーク対策
- [ ] ログ機能充実
- [ ] リカバリー機能

---

## 💭 将来的な拡張 (Phase 5)

### 機能追加

- [ ] **WebUI（オプション）**
  - [ ] フロントエンド (React/Vue)
  - [ ] リアルタイム波形表示
  - [ ] 設定UI
  - [ ] プリセット管理

- [ ] **モデル管理機能**
  - [ ] モデル一覧表示
  - [ ] モデルのインポート/エクスポート
  - [ ] ホットスワップ（再起動不要）

- [ ] **プリセット機能**
  - [ ] 設定の保存/読み込み
  - [ ] プリセットのシェア

- [ ] **録音機能**
  - [ ] 変換前/変換後の録音
  - [ ] WAV/MP3エクスポート

- [ ] **エフェクトチェーン**
  - [ ] リバーブ
  - [ ] コンプレッサー
  - [ ] EQ
  - [ ] ノイズゲート

### パフォーマンス

- [ ] **ONNX対応検討**
  - [ ] RVCモデルのONNX化
  - [ ] Rustでの推論（ort-rs）

- [ ] **バッチ処理最適化**
  - [ ] 複数チャンクをまとめて処理

- [ ] **GPU最適化**
  - [ ] 複数GPUの活用
  - [ ] メモリプール

### クロスプラットフォーム

- [ ] **Windows対応強化**
  - [ ] インストーラー作成
  - [ ] 仮想マイク自動セットアップ

- [ ] **macOS対応強化**
  - [ ] .app バンドル作成
  - [ ] BlackHole自動インストール

- [ ] **Linux対応強化**
  - [ ] .deb/.rpm パッケージ
  - [ ] PulseAudio/PipeWire対応

---

## 🐛 既知の課題

### 高優先度

- [ ] チャンク境界の不自然さ
  - 対策案: クロスフェード処理
  - 対策案: オーバーラップ処理

- [ ] 長時間実行時のメモリリーク（要確認）
  - 調査: セッション管理のクリーンアップ

### 中優先度

- [ ] RVCデモモードの品質向上
  - librosa.pitch_shift以外の手法検討

- [ ] エラーメッセージの日本語対応

### 低優先度

- [ ] ログフォーマットの統一
- [ ] 設定ファイルのバリデーション強化

---

## 📊 タスク進捗サマリー

### Phase 1: 基盤構築
✅ **完了** (2025-11-17)
- プロジェクト構造設計
- uv統合セットアップ
- 基本CLI実装
- 揺らぎエンジン実装

### Phase 2: コア機能実装
✅ **完了** (2025-11-17)
- RVC変換エンジン
- FastAPIサーバー
- Rust HTTPクライアント
- Docker対応

### Phase 3: リアルタイム対応
🚧 **進行中** (70%完了)
- [x] 音声I/O実装
- [x] API統合
- [ ] リアルタイムモード完全実装 ← **現在ここ**
- [ ] 遅延最適化

### Phase 4: 実用化
📅 **計画中**
- [ ] 実際のRVCモデル統合
- [ ] 仮想マイク統合
- [ ] 安定性向上

### Phase 5: 拡張機能
💭 **検討中**
- [ ] WebUI
- [ ] 高度な機能追加

---

## 📝 次回セッションのアクション

### 最優先タスク

1. **リアルタイムモードの実装完了**
   ```rust
   // src/main.rs の monitor_realtime() 関数を完成させる
   async fn monitor_realtime(...) -> Result<()> {
       // TODO: 実装
   }
   ```

2. **遅延測定スクリプトの作成**
   ```python
   # python/benchmark.py
   def measure_latency():
       # 各段階の遅延を測定
   ```

3. **チャンク境界のクロスフェード実装**
   ```python
   # python/rvc_engine.py
   def process_chunk_with_crossfade(...):
       # オーバーラップ処理
   ```

### セカンダリタスク

4. **ドキュメント整備**
   - ✅ .claude/ 配下のドキュメント作成
   - [ ] RVCモデル取得ガイド作成

5. **テストケース追加**
   - [ ] ユニットテスト (pytest)
   - [ ] 統合テスト

---

## 🎯 マイルストーン

### M3.1: リアルタイムモード完成 (目標: 2025-11-24)
- [ ] マイク→変換→スピーカーの完全動作
- [ ] 遅延500ms以内
- [ ] 音飛びなし

### M3.2: 遅延最適化 (目標: 2025-12-01)
- [ ] 遅延300ms以内を達成
- [ ] 遅延が安定（揺らぎ小）

### M4.1: 仮想マイク統合 (目標: 2025-12-15)
- [ ] Discord等で使用可能
- [ ] 原音漏洩ゼロ確認

### M4.2: 安定版リリース (目標: 2025-12-31)
- [ ] 実用レベルの安定性
- [ ] ドキュメント完備
- [ ] サンプルモデル提供

---

## 📚 参考資料・リンク

### 技術資料
- [RVC WebUI](https://github.com/RVC-Project/Retrieval-based-Voice-Conversion-WebUI)
- [cpal ドキュメント](https://docs.rs/cpal)
- [FastAPI ドキュメント](https://fastapi.tiangolo.com/)
- [uv ドキュメント](https://github.com/astral-sh/uv)

### 仮想マイク
- [VB-Cable (Windows)](https://vb-audio.com/Cable/)
- [VoiceMeeter (Windows)](https://vb-audio.com/Voicemeeter/)
- [BlackHole (macOS)](https://existential.audio/blackhole/)
- [Loopback (macOS)](https://rogueamoeba.com/loopback/)
- [ALSA Loopback (Linux)](https://www.alsa-project.org/)

---

## 🔄 変更履歴

### 2025-11-17
- プロジェクト開始
- Phase 1, 2 完了
- Phase 3 開始
- .claude/ ドキュメント作成

---

**最終更新**: 2025-11-17
**現在のフェーズ**: Phase 3 (70%完了)
**次のマイルストーン**: M3.1 (リアルタイムモード完成)
